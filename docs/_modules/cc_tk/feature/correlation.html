<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>cc_tk.feature.correlation &mdash; Toolkit 0.3.0 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dist/theme.css?v=f85e6685" />
            <link rel="index" title="Index" href="../../../genindex.html" />
            <link rel="search" title="Search" href="../../../search.html" />
            <link rel="top" title="Toolkit 0.3.0 documentation" href="#" />
            <link rel="up" title="Module code" href="../../index.html" />
    </head>
<body>
    <script type="text/javascript" src="../../../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../../../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../../../_static/img/wagtail-logo-new.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        Sphinx Wagtail Theme
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../../../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">cc_tk</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cc_tk.html">cc_tk package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../cc_tk.feature.html">cc_tk.feature package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cc_tk.plot.html">cc_tk.plot package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cc_tk.util.html">cc_tk.util package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../../../index.html">Docs</a></li>
            <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
        <li class="breadcrumb-item active" aria-current="page">cc_tk.feature.correlation</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/wagtail/sphinx_wagtail_theme/blob/main/docs/_modules/cc_tk/feature/correlation" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <h1>Source code for cc_tk.feature.correlation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Scikit-learn like estimators to deal with correlation in variables.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">squareform</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.validation</span> <span class="kn">import</span> <span class="n">check_array</span><span class="p">,</span> <span class="n">check_is_fitted</span><span class="p">,</span> <span class="n">check_X_y</span>

<span class="kn">from</span> <span class="nn">cc_tk.util.types</span> <span class="kn">import</span> <span class="n">ArrayLike1D</span><span class="p">,</span> <span class="n">ArrayLike2D</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># pylint: disable=W0201</span>
<div class="viewcode-block" id="CorrelationToTarget">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.CorrelationToTarget">[docs]</a>
<span class="k">class</span> <span class="nc">CorrelationToTarget</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select columns with correlation to target above a threshold.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    threshold : float, optional</span>
<span class="sd">        The threshold for the correlation to the target.</span>
<span class="sd">        Default is 0.1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

<div class="viewcode-block" id="CorrelationToTarget.fit">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.CorrelationToTarget.fit">[docs]</a>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">ArrayLike2D</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike1D</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CorrelationToTarget&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the transformer to the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : ArrayLike2D</span>
<span class="sd">            The features.</span>
<span class="sd">        y : ArrayLike1D</span>
<span class="sd">            The target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_numeric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">=</span> <span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">features_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Threshold </span><span class="si">%s</span><span class="s2"> is too high, no columns should &quot;</span>
                <span class="s2">&quot;have been selected. Selecting columns with highest &quot;</span>
                <span class="s2">&quot;correlation.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1"># pylint: disable=W0613</span>
<div class="viewcode-block" id="CorrelationToTarget.transform">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.CorrelationToTarget.transform">[docs]</a>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">ArrayLike2D</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike1D</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike2D</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve only the selected columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : ArrayLike2D</span>
<span class="sd">            The features.</span>
<span class="sd">        y : ArrayLike1D, optional</span>
<span class="sd">            The target, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ArrayLike2D</span>
<span class="sd">            The selected features.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of columns in features is different from the number of</span>
<span class="sd">            columns in the training data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mask_selection_&quot;</span><span class="p">,</span> <span class="s2">&quot;n_features_in_&quot;</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Shape of input is different from what was seen in `fit`&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">]</span></div>


<div class="viewcode-block" id="CorrelationToTarget.plot_correlation">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.CorrelationToTarget.plot_correlation">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the correlation of each feature to the target.</span>

<span class="sd">        The selected features are highlighted in green, the others in red.</span>
<span class="sd">        The threshold values are indicated with dashed lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mask_selection_&quot;</span><span class="p">,</span> <span class="s2">&quot;n_features_in_&quot;</span><span class="p">])</span>
        <span class="n">plot_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Correlation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">,</span>
                <span class="s2">&quot;Columns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span>
                <span class="s2">&quot;Selected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">plot_df</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Correlation&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Columns&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Correlation&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">plot_df</span><span class="p">[</span><span class="s2">&quot;Selected&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;tab:green&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;tab:red&quot;</span><span class="p">}</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span>
            <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">],</span>
            <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">plot_df</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Correlation to target&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>
</div>



<span class="c1"># pylint: disable=W0201</span>
<div class="viewcode-block" id="ClusteringCorrelation">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation">[docs]</a>
<span class="k">class</span> <span class="nc">ClusteringCorrelation</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scikit-learn like estimator to deal with group of correlated features.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">summary_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;pca&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">,</span>
        <span class="n">n_variables_by_cluster</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Feature selector based on Clustering of correlations</span>
<span class="sd">        https://kobia.fr/automatiser-la-reduction-des-correlations-par-clustering/</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threshold : float, optional</span>
<span class="sd">            Correlation threshold to consider that a group of variables</span>
<span class="sd">            are all correlated together, by default 0.1</span>
<span class="sd">            0.1 means that all variables in the same cluster have a correlation</span>
<span class="sd">            of less than 0.1</span>
<span class="sd">        summary_method : str, optional</span>
<span class="sd">            Method to summarize each cluster of variables, implemented methods are:</span>
<span class="sd">            - &quot;first&quot; = keep only first variable</span>
<span class="sd">            - &quot;pca&quot; = performs principal component analysis to keep only the first</span>
<span class="sd">                component</span>
<span class="sd">            , by default &quot;first&quot;</span>
<span class="sd">        n_variables_by_cluster : int, optional</span>
<span class="sd">            Number of variables to extract by cluster, by default 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="k">assert</span> <span class="n">summary_method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;pca&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summary_method</span> <span class="o">=</span> <span class="n">summary_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_variables_by_cluster</span> <span class="o">=</span> <span class="n">n_variables_by_cluster</span>

<div class="viewcode-block" id="ClusteringCorrelation.fit">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation.fit">[docs]</a>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the feature selection to features</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : pd.DataFrame</span>
<span class="sd">            Features to fit the feature selection to</span>
<span class="sd">        y : pd.Series, optional</span>
<span class="sd">            Target, by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ensure_min_features</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">=</span> <span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Computing correlation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">features_</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">)</span>
        <span class="c1"># Symmetrizing correlation matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># Filling diagonal with 1</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Computing distance matrix</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Clustering with complete linkage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_corr_linkage</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">complete</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clusters_col_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clusters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr_linkage</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_method</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_columns_</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">cluster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters_col_</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_variables_by_cluster</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_columns_</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_method</span> <span class="o">==</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pca_by_cluster_</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">PCA</span><span class="p">(</span>
                    <span class="n">n_components</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_variables_by_cluster</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="n">cluster</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters_col_</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">cluster</span><span class="p">))</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">n_components_</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">pca</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pca_by_cluster_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters_col_</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1"># pylint: disable=W0613</span>
<div class="viewcode-block" id="ClusteringCorrelation.transform">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation.transform">[docs]</a>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply feature selection to DataFrame features and return the</span>
<span class="sd">        transformed variables</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : pd.DataFrame</span>
<span class="sd">            Features</span>
<span class="sd">        y : pd.Series, optional</span>
<span class="sd">            Target, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Transformed features with feature selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;clusters_col_&quot;</span><span class="p">,</span> <span class="s2">&quot;n_features_in_&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Shape of input is different from what was seen in `fit`&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_method</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mask_selection_&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">features_</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_method</span> <span class="o">==</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
            <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pca_by_cluster_&quot;</span><span class="p">])</span>
            <span class="n">features_by_cluster</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pca</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">pca_output_columns</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pca_by_cluster_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusters_col_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_columns</span>
            <span class="p">):</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pca_output_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">cluster</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">pca_output</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                    <span class="n">features_</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="n">cluster</span><span class="p">)]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pca_output</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                    <span class="n">pca_output</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pca_output_columns</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pca_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                        <span class="n">pca_output</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span><span class="n">pca_output_columns</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">features_by_cluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pca_output</span><span class="p">)</span>
            <span class="n">features_transform</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">features_by_cluster</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">features_transform</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">index</span>
                <span class="k">return</span> <span class="n">features_transform</span>
            <span class="k">return</span> <span class="n">features_transform</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="n">features</span></div>


<div class="viewcode-block" id="ClusteringCorrelation.plot_dendro">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation.plot_dendro">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_dendro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot dendrogram of the correlation matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            Axis to plot the dendrogram on, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Any]</span>
<span class="sd">            Dendrogram object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dendro</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_corr_linkage</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span>
            <span class="n">color_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dendro</span></div>


<div class="viewcode-block" id="ClusteringCorrelation.plot_correlation_matrix">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation.plot_correlation_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_correlation_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot correlation matrix of the features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig : plt.Figure, optional</span>
<span class="sd">            Figure to plot the correlation matrix on, by default None</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            Axis to plot the correlation matrix on, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            Axis with the correlation matrix&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dendro</span><span class="p">[</span><span class="s2">&quot;leaves&quot;</span><span class="p">],</span> <span class="p">:][:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dendro</span><span class="p">[</span><span class="s2">&quot;leaves&quot;</span><span class="p">]])</span>
        <span class="p">)</span>
        <span class="n">dendro_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dendro</span><span class="p">[</span><span class="s2">&quot;ivl&quot;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">dendro_idx</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">dendro_idx</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dendro</span><span class="p">[</span><span class="s2">&quot;ivl&quot;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dendro</span><span class="p">[</span><span class="s2">&quot;ivl&quot;</span><span class="p">])</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">ticker</span><span class="o">.</span><span class="n">PercentFormatter</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="ClusteringCorrelation.get_clusters">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.ClusteringCorrelation.get_clusters">[docs]</a>
    <span class="k">def</span> <span class="nf">get_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linkage</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the cluster of variables given a specific threshold</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        linkage : np.ndarray</span>
<span class="sd">            Linkage matrix from scipy.cluster.hierarchy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[List[str]]</span>
<span class="sd">            List of lists of variable names according to each cluster</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Rcupration des clusters  partir de la hirarchie</span>
        <span class="n">cluster_ids</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">fcluster</span><span class="p">(</span>
            <span class="n">linkage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Assignation des index de chaque variable dans un dictionnaire</span>
        <span class="n">cluster_id_to_feature_ids</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_ids</span><span class="p">):</span>
            <span class="n">cluster_id_to_feature_ids</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="c1"># Rcupration de la liste des clusters (indices des variables)</span>
        <span class="n">clusters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cluster_id_to_feature_ids</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="c1"># Rcupration de la liste des clusters (noms des variables)</span>
        <span class="n">clusters_col</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">clusters_col</span></div>
</div>



<div class="viewcode-block" id="PairwiseCorrelationDrop">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.PairwiseCorrelationDrop">[docs]</a>
<span class="k">class</span> <span class="nc">PairwiseCorrelationDrop</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scikit-learn like estimator to deal with pair-wise correlation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements the variable selection based on pair-wise correlation</span>
<span class="sd">        through a scikit-learn transformer explained in</span>
<span class="sd">        https://towardsdatascience.com/are-you-dropping-too-many-correlated-features-d1c96654abe6</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threshold : float, optional</span>
<span class="sd">            pairwise correlation threshold to consider dropping one of the two</span>
<span class="sd">            variables in the pair, by default 0.9</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

<div class="viewcode-block" id="PairwiseCorrelationDrop.fit">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.PairwiseCorrelationDrop.fit">[docs]</a>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">ArrayLike2D</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike1D</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PairwiseCorrelationDrop&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the transformer to the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : ArrayLike2D</span>
<span class="sd">            Features</span>
<span class="sd">        y : ArrayLike1D, optional</span>
<span class="sd">            Target, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PairwiseCorrelationDrop</span>
<span class="sd">            Fitted transformer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features_</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">check_X_y</span><span class="p">(</span>
            <span class="n">features</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ensure_min_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_min_samples</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span> <span class="o">=</span> <span class="n">features_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_mask_selection</span><span class="p">(</span>
            <span class="n">features_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_columns_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1"># pylint: disable=W0613</span>
<div class="viewcode-block" id="PairwiseCorrelationDrop.transform">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.PairwiseCorrelationDrop.transform">[docs]</a>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">ArrayLike2D</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">ArrayLike1D</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike2D</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve only the selected columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : ArrayLike2D</span>
<span class="sd">            Features</span>
<span class="sd">        y : ArrayLike1D, optional</span>
<span class="sd">            Target, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ArrayLike2D</span>
<span class="sd">            Selected features</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of columns in features is different from the number of</span>
<span class="sd">            columns in the training data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">ensure_min_features</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mask_selection_&quot;</span><span class="p">,</span> <span class="s2">&quot;n_features_in_&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features_in_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Shape of input is different from what was seen in `fit`&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_selection_</span><span class="p">]</span></div>


<div class="viewcode-block" id="PairwiseCorrelationDrop.compute_mask_selection">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.PairwiseCorrelationDrop.compute_mask_selection">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compute_mask_selection</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">cut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the mask of variables to keep based on pair-wise correlation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        features : np.ndarray</span>
<span class="sd">            Features</span>
<span class="sd">        cut : float, optional</span>
<span class="sd">            Correlation threshold, by default 0.9</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Mask of variables to keep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get correlation matrix and upper triagle</span>
        <span class="n">corr_mtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">avg_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">corr_mtx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">corr_mtx</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">dropcols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">up</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">col_idx</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">up</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">corr_mtx</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cut</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">avg_corr</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">avg_corr</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                        <span class="n">dropcols</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">drop</span> <span class="o">=</span> <span class="n">row</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dropcols</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">drop</span> <span class="o">=</span> <span class="n">col</span>

                    <span class="n">step_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">row</span><span class="p">,</span>
                            <span class="n">col</span><span class="p">,</span>
                            <span class="n">avg_corr</span><span class="p">[</span><span class="n">row</span><span class="p">],</span>
                            <span class="n">avg_corr</span><span class="p">[</span><span class="n">col</span><span class="p">],</span>
                            <span class="n">up</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span>
                            <span class="n">drop</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step_results</span><span class="p">)</span>

        <span class="n">mask_selection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">res</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;v1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;v2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;v1.target&quot;</span><span class="p">,</span>
                <span class="s2">&quot;v2.target&quot;</span><span class="p">,</span>
                <span class="s2">&quot;corr&quot;</span><span class="p">,</span>
                <span class="s2">&quot;drop&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="n">dropcols_indices</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compute_drop_indices_from_detailed_steps</span><span class="p">(</span>
                <span class="n">res</span>
            <span class="p">)</span>
            <span class="n">mask_selection</span><span class="p">[</span><span class="n">dropcols_indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">mask_selection</span></div>


<div class="viewcode-block" id="PairwiseCorrelationDrop.compute_drop_indices_from_detailed_steps">
<a class="viewcode-back" href="../../../cc_tk.feature.html#cc_tk.feature.correlation.PairwiseCorrelationDrop.compute_drop_indices_from_detailed_steps">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_drop_indices_from_detailed_steps</span><span class="p">(</span>
        <span class="n">res</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the indices of variables to drop from the detailed steps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        res : pd.DataFrame</span>
<span class="sd">            Detailed steps of the pairwise correlation drop</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            Indices of variables to drop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># All variables with correlation &gt; cutoff</span>
        <span class="n">all_corr_vars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;v2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

        <span class="c1"># All unique variables in drop column</span>
        <span class="n">poss_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;drop&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>

        <span class="c1"># Keep any variable not in drop column</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_corr_vars</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">poss_drop</span><span class="p">)))</span>

        <span class="c1"># Drop any variables in same row as a keep variable</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> <span class="o">|</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;v2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">keep</span><span class="p">)][[</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="s2">&quot;v2&quot;</span><span class="p">]]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;v2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
        <span class="n">drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keep</span><span class="p">)))</span>

        <span class="c1"># Remove drop variables from possible drop</span>
        <span class="n">poss_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">poss_drop</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">drop</span><span class="p">)))</span>

        <span class="c1"># subset res dataframe to include possible drop pairs</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">poss_drop</span><span class="p">)</span> <span class="o">|</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;v2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">poss_drop</span><span class="p">)][</span>
            <span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="s2">&quot;drop&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># remove rows that are decided (drop), take set and add to drops</span>
        <span class="n">more_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">drop</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;v2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">drop</span><span class="p">)][</span><span class="s2">&quot;drop&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">more_drop</span><span class="p">:</span>
            <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span></div>
</div>

</pre></div>
</main>
                        
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/features/">Features</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/about-wagtail/"> About Wagtail</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/services/"> Services</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/blog/"> Blog</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/packages/"> Packages</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/developers/"> Developers</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                <p style="display: none">
                    <a class="text-light" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Wagtail Sphinx Theme 6.1.1
                    </a>
                </p>
            </div>
            <div class="text-center">
                    &copy; Copyright 2023, Clment CME
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="../../../_static/documentation_options.js?v=e259d695"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script type="text/javascript" src="../../../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../../../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../../../_static/searchtools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../../../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>